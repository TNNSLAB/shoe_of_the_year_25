<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shoe Placement Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <div class="flex flex-col items-center min-h-screen py-8 space-y-6">
    <!-- Dropdown -->
    <select id="shoe-select" class="px-4 py-2 border border-gray-300 rounded shadow">
      <option value="">Select a shoe</option>
    </select>

    <!-- Template display container -->
    <div id="canvas-container" class="relative border shadow-lg w-full max-w-md">
      <img id="template" 
           src="images/template.png" 
           alt="Template" 
           class="w-full h-auto pointer-events-none select-none">
      <div id="shoe-layer" class="absolute top-0 left-0 w-full h-full"></div>
    </div>

    <!-- Download Button -->
    <button id="download-btn" class="px-6 py-2 bg-blue-600 text-white rounded shadow hover:bg-blue-700">
      Download Image
    </button>
  </div>

  <script>
    const BASE_WIDTH = 1080;
    const BASE_HEIGHT = 1920;

    // Bounding box for shoe placement
    const shoeBox = {
      x: 251,
      y: 376,
      width: 650,
      height: 322
    };

    // Shoe data
    const shoes = [
      { name: "Red Sneaker", image: "images/shoe1.png" },
      { name: "Blue Runner", image: "images/shoe2.png" }
    ];

    const shoeSelect = document.getElementById('shoe-select');
    const shoeLayer = document.getElementById('shoe-layer');
    const templateImg = document.getElementById('template');

    // Populate dropdown
    shoes.forEach((shoe, index) => {
      const option = document.createElement('option');
      option.value = index;
      option.textContent = shoe.name;
      shoeSelect.appendChild(option);
    });

    // Place shoe in bounding box (browser display)
    function placeShoe(index) {
      shoeLayer.innerHTML = '';
      if (index !== "") {
        const shoe = shoes[index];

        const img = document.createElement('img');
        img.src = shoe.image;
        img.className = 'absolute';

        const displayImg = new Image();
        displayImg.src = shoe.image;
        displayImg.onload = () => {
          // Scale proportionally to fit bounding box
          const ratio = Math.min(shoeBox.width / displayImg.width, shoeBox.height / displayImg.height);
          const displayWidth = displayImg.width * ratio;
          const displayHeight = displayImg.height * ratio;

          img.style.width = `${displayWidth}px`;
          img.style.height = `${displayHeight}px`;
          img.style.left = `${shoeBox.x}px`;
          img.style.top = `${shoeBox.y}px`;

          shoeLayer.appendChild(img);
        };
      }
    }

    shoeSelect.addEventListener('change', e => {
      placeShoe(e.target.value);
    });

    window.addEventListener('resize', () => {
      if (shoeSelect.value !== "") placeShoe(shoeSelect.value);
    });

    // Download full-size image (1080x1920) with shoes at original size (520x330)
    document.getElementById('download-btn').addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      canvas.width = BASE_WIDTH;
      canvas.height = BASE_HEIGHT;
      const ctx = canvas.getContext('2d');

      const template = new Image();
      template.src = 'images/template.png';
      template.onload = () => {
        ctx.drawImage(template, 0, 0, BASE_WIDTH, BASE_HEIGHT);

        const selectedIndex = shoeSelect.value;
        if (selectedIndex !== "") {
          const shoe = new Image();
          shoe.src = shoes[selectedIndex].image;
          shoe.onload = () => {
            ctx.drawImage(shoe, shoeBox.x, shoeBox.y, shoe.width, shoe.height); // original size
            // Download
            const link = document.createElement('a');
            link.download = 'shoe-placement.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
          };
        } else {
          // Only template
          const link = document.createElement('a');
          link.download = 'shoe-placement.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
        }
      };
    });
  </script>

</body>
</html>