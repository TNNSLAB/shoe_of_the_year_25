<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shoe Placement Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <div class="flex flex-col items-center min-h-screen py-8 space-y-6">
    <!-- Dropdowns -->
    <select id="shoe1-select" class="px-4 py-2 border border-gray-300 rounded shadow">
      <option value="">Select first shoe</option>
    </select>

    <select id="shoe2-select" class="px-4 py-2 border border-gray-300 rounded shadow">
      <option value="">Select second shoe</option>
    </select>

    <!-- Template display container -->
    <div id="canvas-container" class="relative border shadow-lg w-full max-w-md">
      <img id="template" 
           src="images/template.png" 
           alt="Template" 
           class="w-full h-auto pointer-events-none select-none">
      <div id="shoe-layer" class="absolute top-0 left-0 w-full h-full"></div>
    </div>

    <!-- Download Button -->
    <button id="download-btn" class="px-6 py-2 bg-blue-600 text-white rounded shadow hover:bg-blue-700">
      Download Image
    </button>
  </div>

  <script>
    const BASE_WIDTH = 1080;
    const BASE_HEIGHT = 1920;

    // Bounding boxes
    const shoeBox1 = { x: 251, y: 376, width: 650, height: 322 };
    const shoeBox2 = { x: 251, y: 732, width: 574, height: 325 };

    // Shoe data
    const shoes = [
      { name: "Red Sneaker", image: "images/shoe1.png" },
      { name: "Blue Runner", image: "images/shoe2.png" }
    ];

    const shoe1Select = document.getElementById('shoe1-select');
    const shoe2Select = document.getElementById('shoe2-select');
    const shoeLayer = document.getElementById('shoe-layer');
    const templateImg = document.getElementById('template');

    // Populate dropdowns
    shoes.forEach((shoe, index) => {
      const option1 = document.createElement('option');
      option1.value = index;
      option1.textContent = shoe.name;
      shoe1Select.appendChild(option1);

      const option2 = document.createElement('option');
      option2.value = index;
      option2.textContent = shoe.name;
      shoe2Select.appendChild(option2);
    });

    function placeShoe(displayIndex, box) {
      if (displayIndex === "") return null;

      const img = document.createElement('img');
      img.src = shoes[displayIndex].image;
      img.className = 'absolute';

      const displayImg = new Image();
      displayImg.src = shoes[displayIndex].image;
      displayImg.onload = () => {
        const templateWidth = templateImg.clientWidth;
        const templateHeight = templateImg.clientHeight;

        const scaleX = templateWidth / BASE_WIDTH;
        const scaleY = templateHeight / BASE_HEIGHT;

        const displayX = box.x * scaleX;
        const displayY = box.y * scaleY;

        const displayWidth = displayImg.width * scaleX;
        const displayHeight = displayImg.height * scaleY;

        img.style.width = `${displayWidth}px`;
        img.style.height = `${displayHeight}px`;
        img.style.left = `${displayX}px`;
        img.style.top = `${displayY}px`;

        shoeLayer.appendChild(img);
      };
      return img;
    }

    function updateDisplay() {
      shoeLayer.innerHTML = '';
      placeShoe(shoe1Select.value, shoeBox1);
      placeShoe(shoe2Select.value, shoeBox2);
    }

    shoe1Select.addEventListener('change', updateDisplay);
    shoe2Select.addEventListener('change', updateDisplay);
    window.addEventListener('resize', updateDisplay);

    // Download full-size image with both shoes
    document.getElementById('download-btn').addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      canvas.width = BASE_WIDTH;
      canvas.height = BASE_HEIGHT;
      const ctx = canvas.getContext('2d');

      const template = new Image();
      template.src = 'images/template.png';
      template.onload = () => {
        ctx.drawImage(template, 0, 0, BASE_WIDTH, BASE_HEIGHT);

        // First shoe
        const selectedIndex1 = shoe1Select.value;
        if (selectedIndex1 !== "") {
          const shoe1 = new Image();
          shoe1.src = shoes[selectedIndex1].image;
          shoe1.onload = () => {
            ctx.drawImage(shoe1, shoeBox1.x, shoeBox1.y, shoe1.width, shoe1.height);

            // Second shoe
            const selectedIndex2 = shoe2Select.value;
            if (selectedIndex2 !== "") {
              const shoe2 = new Image();
              shoe2.src = shoes[selectedIndex2].image;
              shoe2.onload = () => {
                ctx.drawImage(shoe2, shoeBox2.x, shoeBox2.y, shoe2.width, shoe2.height);
                const link = document.createElement('a');
                link.download = 'shoe-placement.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
              };
            } else {
              const link = document.createElement('a');
              link.download = 'shoe-placement.png';
              link.href = canvas.toDataURL('image/png');
              link.click();
            }
          };
        } else {
          // Only template or second shoe
          const selectedIndex2 = shoe2Select.value;
          if (selectedIndex2 !== "") {
            const shoe2 = new Image();
            shoe2.src = shoes[selectedIndex2].image;
            shoe2.onload = () => {
              ctx.drawImage(shoe2, shoeBox2.x, shoeBox2.y, shoe2.width, shoe2.height);
              const link = document.createElement('a');
              link.download = 'shoe-placement.png';
              link.href = canvas.toDataURL('image/png');
              link.click();
            };
          } else {
            const link = document.createElement('a');
            link.download = 'shoe-placement.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
          }
        }
      };
    });
  </script>

</body>
</html>